<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pool Smart Calc Pro</title>
    <!-- Подключение библиотек через интернет -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .active-tab { background: white; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); color: #2563eb; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { 
            Waves, Maximize2, Layers, Settings, Zap, 
            Save, Trash2, ClipboardList, Info, ChevronRight, 
            Droplets, Thermometer, Sun, CheckCircle, Shield,
            Layout, Star, Flame, RotateCcw,
            DollarSign, AlertTriangle, RefreshCw, Sparkles, Lock, Box,
            EyeOff, AreaChart, Home, Palette, Beaker, CloudSun, Fuel, MoveDown, Wrench, Phone, User, X, KeyRound 
        } = lucide;

        // Помощник для иконок
        const Icon = ({ name, ...props }) => {
            const LucideIcon = lucide[name];
            return LucideIcon ? <LucideIcon {...props} /> : null;
        };

        const ADMIN_PIN = "8791";

        const DEFAULT_PRICES = {
            workPercent: 0,
            types: {
                concrete: { name: 'Бетонна чаша (м²)', price: 12300 }, 
                fiberglass: { name: 'Композитна (виріб)', price: 550000 }, 
                polypropylene: { name: 'Поліпропілен (м²)', price: 9500 } 
            },
            bowl_installation: {
                concrete: { name: 'Монтаж бетонної чаші (м²)', price: 4500 },
                fiberglass: { name: 'Монтаж композиту (м²)', price: 3200 },
                polypropylene: { name: 'Монтаж поліпропілену (м²)', price: 2800 }
            },
            finishes: {
                mosaic: { name: 'Мозаїка (м²)', price: 5200 },
                liner: { name: 'Лайнер ПВХ (м²)', price: 2800 },
                polymer: { name: 'Полімер (м²)', price: 3500 }
            },
            tiered_equipment: {
                filtration: { name: 'Фільтрація (обладнання)', small: 45000, medium: 85000, large: 125000, xlarge: 165000 },
                disinfection: { name: 'Авто-дезінфекція', small: 28000, medium: 42000, large: 68000, xlarge: 82000 },
                heating_pump: { name: 'Тепловий насос', small: 85000, medium: 125000, large: 195000, xlarge: 265000 },
                heating_electric: { name: 'Електропідігрів', small: 18000, medium: 28000, large: 45000, xlarge: 65000 },
                heating_solar: { name: 'Сонячний підігрів', small: 12000, medium: 22000, large: 45000, xlarge: 65000 },
                heating_gas: { name: 'Від газового котла', small: 25000, medium: 45000, large: 75000, xlarge: 95000 },
                cover_pavilion: { name: 'Павільйон', small: 185000, medium: 320000, large: 580000, xlarge: 750000 },
                cover_shutter: { name: 'Ролета', small: 95000, medium: 165000, large: 290000, xlarge: 380000 }
            },
            tiered_installation: {
                filtration_install: { name: 'Монтаж фільтрації', small: 8000, medium: 12000, large: 18000, xlarge: 25000 },
                heating_install: { name: 'Монтаж підігріву', small: 5000, medium: 7000, large: 10000, xlarge: 15000 },
                attraction_install: { name: 'Монтаж атракціонів', small: 4000, medium: 6000, large: 9000, xlarge: 12000 },
                cover_install: { name: 'Монтаж накриття', small: 12000, medium: 18000, large: 25000, xlarge: 35000 },
                electric_works: { name: 'Електромонтаж та автоматика', small: 4500, medium: 6500, large: 9500, xlarge: 14000 }
            },
            options: {
                steps: { name: 'Вхід / Вбудовані сходи', price: 45000 },
                lighting: { name: 'LED Освітлення', price: 28000 },
                counterflow: { name: 'Протитік (Turbo)', price: 140000 },
                hydromassage: { name: 'Гідромасаж (SPA)', price: 115000 },
                waterfall: { name: 'Водоспад (Decor)', price: 65000 },
                disinfection_manual: { name: 'Ручна дезінфекція', price: 8500 }
            }
        };

        function App() {
            const [activeTab, setActiveTab] = useState('calc');
            const [prices, setPrices] = useState(DEFAULT_PRICES);
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminAuth, setShowAdminAuth] = useState(false);
            const [pinInput, setPinInput] = useState('');
            const [clicks, setClicks] = useState(0);
            
            const [dimensions, setDimensions] = useState({ length: 6, width: 3, depth: 1.5 });
            const [poolType, setPoolType] = useState('concrete');
            const [finish, setFinish] = useState('mosaic');
            const [hasSteps, setHasSteps] = useState(false);
            const [disinfection, setDisinfection] = useState('auto');
            const [heating, setHeating] = useState('none');
            const [options, setOptions] = useState({ 
                filtration: true, lighting: true, counterflow: false, 
                hydromassage: false, waterfall: false, cover_pavilion: false, cover_shutter: false 
            });

            const [showLeadModal, setShowLeadModal] = useState(false);
            const [client, setClient] = useState({ name: '', phone: '' });

            const calculation = useMemo(() => {
                const L = parseFloat(dimensions.length) || 0;
                const W = parseFloat(dimensions.width) || 0;
                const D = parseFloat(dimensions.depth) || 0;
                const area = (L * W) + (2 * D * (L + W));
                const volume = L * W * D;
                
                let tier = volume > 80 ? 'xlarge' : volume > 50 ? 'large' : volume > 20 ? 'medium' : 'small';
                let total = 0, work = 0;

                if (poolType === 'fiberglass') total += prices.types.fiberglass.price;
                else total += area * prices.types[poolType].price;
                
                work += area * (prices.bowl_installation?.[poolType]?.price || 0);
                total += area * prices.finishes[finish].price;

                const te = prices.tiered_equipment, ti = prices.tiered_installation;

                if (options.filtration) {
                    total += te.filtration[tier];
                    work += ti.filtration_install[tier] + ti.electric_works[tier];
                }

                if (disinfection === 'auto') total += te.disinfection[tier];
                else if (disinfection === 'manual') total += prices.options.disinfection_manual.price;

                if (heating !== 'none') {
                    const hKey = heating === 'heat_pump' ? 'heating_pump' : `heating_${heating}`;
                    total += te[hKey][tier];
                    work += ti.heating_install[tier];
                }

                if (options.cover_pavilion) { total += te.cover_pavilion[tier]; work += ti.cover_install[tier]; }
                if (options.cover_shutter) { total += te.cover_shutter[tier]; work += ti.cover_install[tier]; }

                if (hasSteps) total += prices.options.steps.price;
                
                ['counterflow', 'hydromassage', 'waterfall', 'lighting'].forEach(k => {
                    if (options[k]) {
                        total += prices.options[k].price;
                        if (k !== 'lighting') work += ti.attraction_install[tier];
                    }
                });

                return { total: total + work, volume, area, tier, work };
            }, [dimensions, poolType, finish, options, hasSteps, disinfection, heating, prices]);

            const handleLogoClick = () => {
                if (isAdmin) return;
                setClicks(prev => {
                    if (prev + 1 >= 5) { setShowAdminAuth(true); return 0; }
                    return prev + 1;
                });
                setTimeout(() => setClicks(0), 3000);
            };

            const unlockAdmin = () => {
                if (pinInput === ADMIN_PIN) { setIsAdmin(true); setShowAdminAuth(false); setActiveTab('settings'); setPinInput(''); }
                else { alert("Помилка PIN-коду"); setPinInput(''); }
            };

            return (
                <div className="max-w-xl mx-auto min-h-screen flex flex-col uppercase font-black text-slate-800 pb-52">
                    {/* Header */}
                    <header className="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b p-4 flex justify-between items-center shadow-md">
                        <div className="flex items-center gap-3" onClick={handleLogoClick}>
                            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                                <Icon name="Waves" size={24} />
                            </div>
                            <div>
                                <h1 className="text-sm leading-none tracking-tighter uppercase font-black">Pool Smart <span className="text-blue-600">Calc</span></h1>
                                <p className="text-[8px] text-slate-400 mt-1 uppercase italic leading-none">Попередній розрахунок</p>
                            </div>
                        </div>
                        <div className="flex bg-slate-100 p-1 rounded-xl gap-1">
                            {['calc', 'history', isAdmin && 'settings'].filter(Boolean).map(t => (
                                <button key={t} onClick={() => setActiveTab(t)} className={`px-4 py-2 text-[9px] rounded-lg transition-all font-black uppercase ${activeTab === t ? 'active-tab' : 'text-slate-400'}`}>
                                    {t === 'calc' ? 'Проєкт' : t === 'history' ? 'Архів' : 'Ціни'}
                                </button>
                            ))}
                        </div>
                    </header>

                    <main className="p-4 space-y-6">
                        {activeTab === 'calc' && (
                            <>
                                {/* Dimensions */}
                                <section className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 space-y-6 font-black uppercase">
                                    <div className="flex justify-between items-center">
                                        <div className="text-blue-600 text-xs flex items-center gap-2"><Icon name="Maximize2" size={18} /> Габарити</div>
                                        <div className="text-[10px] bg-emerald-50 text-emerald-600 px-3 py-1 rounded-full border border-emerald-100">{calculation.tier} • {calculation.volume.toFixed(1)} м³</div>
                                    </div>
                                    <div className="grid grid-cols-3 gap-3">
                                        {['length', 'width', 'depth'].map(k => (
                                            <div key={k} className="text-center">
                                                <span className="text-[8px] text-slate-400 block mb-1 uppercase tracking-widest">{k === 'length' ? 'Довжина' : k === 'width' ? 'Ширина' : 'Глибина'}</span>
                                                <input type="number" step="0.1" value={dimensions[k]} onChange={e => setDimensions({...dimensions, [k]: parseFloat(e.target.value) || 0})} className="w-full bg-slate-50 rounded-2xl py-4 text-center text-lg shadow-inner outline-none focus:ring-2 focus:ring-blue-500 font-black" />
                                            </div>
                                        ))}
                                    </div>
                                    <label className={`flex items-center justify-between p-4 rounded-2xl border-2 transition-all cursor-pointer ${hasSteps ? 'border-blue-500 bg-blue-50 text-blue-600 shadow-sm' : 'border-slate-50 bg-slate-50 text-slate-400'}`}>
                                        <div className="flex items-center gap-3"><Icon name="Layout" size={20} /> <span className="text-xs">Вбудовані сходи</span></div>
                                        <input type="checkbox" checked={hasSteps} onChange={e => setHasSteps(e.target.checked)} className="w-6 h-6 rounded-lg accent-blue-600" />
                                    </label>
                                </section>

                                {/* Construction */}
                                <section className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 font-black uppercase">
                                    <div className="text-blue-600 text-xs flex items-center gap-2 mb-4"><Icon name="Layers" size={18} /> Тип чаші</div>
                                    <div className="grid grid-cols-3 gap-2">
                                        {Object.entries(prices.types).map(([k, v]) => (
                                            <button key={k} onClick={() => setPoolType(k)} className={`py-5 rounded-xl border-2 text-[10px] leading-tight transition-all font-black uppercase ${poolType === k ? 'border-blue-600 bg-blue-50 text-blue-600 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-400'}`}>{v.name}</button>
                                        ))}
                                    </div>
                                </section>

                                {/* Finish */}
                                <section className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 font-black uppercase">
                                    <div className="text-blue-600 text-xs flex items-center gap-2 mb-4"><Icon name="Palette" size={18} /> Оздоблення</div>
                                    <div className="grid grid-cols-3 gap-2">
                                        {Object.entries(prices.finishes).map(([k, v]) => (
                                            <button key={k} onClick={() => setFinish(k)} className={`py-5 px-1 rounded-xl border-2 text-[10px] leading-tight transition-all font-black uppercase ${finish === k ? 'border-blue-600 bg-blue-50 text-blue-600 shadow-md' : 'border-slate-50 bg-slate-50 text-slate-400'}`}>{v.name}</button>
                                        ))}
                                    </div>
                                </section>

                                {/* Equipment */}
                                <section className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 space-y-4 font-black uppercase">
                                    <div className="text-emerald-600 text-xs flex items-center gap-2 uppercase tracking-widest"><Icon name="Settings" size={18} /> Технічне забезпечення</div>
                                    <label className={`flex items-center justify-between p-4 rounded-2xl border-2 transition-all cursor-pointer ${options.filtration ? 'border-emerald-500 bg-emerald-50 text-emerald-700 shadow-sm' : 'bg-slate-50 text-slate-400'}`}>
                                        <div className="flex items-center gap-3"><Icon name="Droplets" size={22} /> <span className="text-sm font-black">Фільтрація води</span></div>
                                        <input type="checkbox" checked={options.filtration} onChange={e => setOptions({...options, filtration: e.target.checked})} className="w-6 h-6 rounded-lg accent-emerald-600" />
                                    </label>
                                    <div className="pt-4 border-t border-slate-50 space-y-3">
                                        <p className="text-[10px] text-slate-400 uppercase font-black">Підігрів води</p>
                                        {['none', 'heat_pump', 'electric', 'solar', 'gas'].map(h => (
                                            <button key={h} onClick={() => setHeating(h)} className={`w-full p-4 rounded-xl border-2 text-left transition-all flex justify-between items-center ${heating === h ? 'border-rose-500 bg-rose-50 text-rose-600 shadow-sm' : 'bg-slate-50 text-slate-400 border-transparent'}`}>
                                                <span className="flex items-center gap-3 text-xs uppercase font-black tracking-tighter">
                                                    <Icon name={h === 'none' ? 'RotateCcw' : h === 'heat_pump' ? 'Zap' : h === 'solar' ? 'CloudSun' : 'Flame'} size={18} />
                                                    {h === 'none' ? 'Без підігріву' : h === 'heat_pump' ? 'Тепловий насос' : h === 'electric' ? 'Електропідігрів' : h === 'solar' ? 'Сонячний' : 'Газовий котел'}
                                                </span>
                                                {heating === h && <Icon name="CheckCircle" size={18} />}
                                            </button>
                                        ))}
                                    </div>
                                </section>
                            </>
                        )}

                        {activeTab === 'settings' && isAdmin && (
                            <div className="space-y-6 font-black uppercase">
                                <div className="bg-blue-600 text-white p-7 rounded-3xl flex items-center justify-between shadow-xl border-b-4 border-blue-800">
                                    <div className="text-sm uppercase tracking-widest">Прайс (Адмін)</div>
                                    <button onClick={() => setIsAdmin(false)} className="text-[9px] opacity-70 underline">Вийти</button>
                                </div>
                                <div className="bg-white rounded-3xl p-6 shadow-sm border space-y-5">
                                    <div className="text-blue-600 text-[10px] uppercase font-black border-b pb-3 tracking-widest leading-none">Монтаж чаші (за 1 м²)</div>
                                    {Object.entries(prices.bowl_installation).map(([k, v]) => (
                                        <div key={k} className="flex justify-between items-center gap-4">
                                            <span className="text-[10px] text-slate-500 uppercase leading-none font-black">{v.name}</span>
                                            <input type="number" value={v.price} onChange={e => {
                                                const p = {...prices}; p.bowl_installation[k].price = parseFloat(e.target.value) || 0; setPrices(p);
                                            }} className="w-28 bg-blue-50/50 rounded-xl p-3 text-right text-xs font-black outline-none border-none shadow-inner" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t p-6 rounded-t-[3rem] shadow-[0_-15px_40px_rgba(0,0,0,0.1)] z-[40]">
                        <div className="max-w-xl mx-auto flex items-center justify-between">
                            <div className="pr-4">
                                <p className="text-[9px] text-slate-400 leading-none mb-1 uppercase font-black tracking-widest">Попередня вартість:</p>
                                <div className="text-3xl tracking-tighter text-blue-600 leading-none font-black">{calculation.total.toLocaleString()} <span className="text-sm font-bold">грн</span></div>
                                <div className="mt-3 flex items-center gap-2 bg-slate-100 px-3 py-2 rounded-xl border border-slate-200">
                                    <Icon name="AlertTriangle" size={16} className="text-slate-900 shrink-0" />
                                    <p className="text-[10px] text-slate-900 leading-tight italic font-black uppercase tracking-tight">
                                        Без урахування земельних, підготовчих та транспортних витрат
                                    </p>
                                </div>
                            </div>
                            <button onClick={() => setShowLeadModal(true)} className="bg-blue-600 text-white px-8 py-5 rounded-2xl shadow-xl shadow-blue-200 active:scale-95 transition-all flex items-center gap-3 uppercase text-[11px] font-black border-b-4 border-blue-800 shrink-0">
                                <Icon name="Save" size={20} /> Зберегти
                            </button>
                        </div>
                    </footer>

                    {/* Admin Auth PIN Modal */}
                    {showAdminAuth && (
                        <div className="fixed inset-0 z-[110] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-6 animate-in zoom-in-95 duration-200 font-black uppercase">
                            <div className="bg-white w-full max-w-sm rounded-[3rem] p-10 shadow-2xl relative border-2 border-blue-50">
                                <button onClick={() => setShowAdminAuth(false)} className="absolute top-8 right-8 text-slate-300"><Icon name="X" size={24} /></button>
                                <div className="text-center mb-8">
                                    <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-5 border border-blue-100 shadow-inner"><Icon name="KeyRound" size={32} /></div>
                                    <h2 className="text-xl font-black text-slate-900 leading-none tracking-widest">Вхід для майстра</h2>
                                </div>
                                <input 
                                    type="password" 
                                    placeholder="PIN-код" 
                                    value={pinInput} 
                                    onChange={e => setPinInput(e.target.value)} 
                                    onKeyDown={e => e.key === 'Enter' && (pinInput === ADMIN_PIN ? (setIsAdmin(true), setShowAdminAuth(false), setActiveTab('settings')) : alert("Помилка PIN-коду"))} 
                                    className="w-full bg-slate-50 rounded-2xl py-6 text-center text-3xl tracking-[0.6em] outline-none focus:ring-2 focus:ring-blue-500 mb-6 font-black shadow-inner" 
                                    autoFocus 
                                />
                                <button onClick={() => pinInput === ADMIN_PIN ? (setIsAdmin(true), setShowAdminAuth(false), setActiveTab('settings')) : alert("Помилка PIN-коду")} className="w-full bg-blue-600 text-white py-5 rounded-2xl shadow-xl uppercase text-xs font-black tracking-widest border-b-4 border-blue-800">Підтвердити</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

